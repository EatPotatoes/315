---
title: "Final Project"
output:
  html_document:
    df_print: paged
    self_contained: yes
date: "2025-11-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(tidyverse)
library(dendextend)
library(gganimate)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
library(viridis)

```

```{r}
# https://www.kaggle.com/datasets/gregorut/videogamesales?select=vgsales.csv
data = read_csv("vgsales.csv")
```

```{r}
data = data %>% 
  mutate(Year = as.numeric(Year))

head(data, 5)
colnames(data)
```

```{r}
data %>% filter(Year >= 2017)
# NOTE: Data only really reliable up to and including 2016
```


```{r}
# 
data = data %>%
  mutate(Platform_Group = case_when(
    Platform %in% c("NES","SNES","N64","GBA","DS","3DS","Wii","WiiU","GC","GB") ~ "Nintendo",
    Platform %in% c("PS","PS2","PS3","PS4","PSP","PSV") ~ "PlayStation",
    Platform %in% c("XB","X360","XOne") ~ "Xbox",
    Platform %in% c("PC","PCFX") ~ "PC",
    TRUE ~ "Other"
  ))

```


```{r}
data %>%
  filter(Year != "N/A") %>% 
  group_by(Year) %>% 
  summarize(Global_Sales_Year = sum(Global_Sales),
            Genre = Genre) %>% 
  ggplot() + 
  aes(x = Year, y = Global_Sales_Year) +
  geom_col() +
  facet_wrap(~ Genre) +
  theme(axis.text.x = element_text(angle=-90))
```

```{r}
genre_platform_data = data %>% 
  group_by(Platform_Group, Genre) %>% 
  summarize(Global_Sales = sum(Global_Sales, na.rm = TRUE)) %>% 
  ungroup()

genre_platform_data$Genre = reorder(genre_platform_data$Genre,
                                    -genre_platform_data$Global_Sales)

# genre_platform_data %>% 
#   ggplot() + 
#   aes(x = Platform_Group, y = Genre, fill = Global_Sales) +
#   geom_tile(color = "white") +
#   scale_fill_gradient(low = "lightblue", high = "darkblue")

genre_platform_data %>% 
  ggplot() + 
  aes(x = Genre, y = Global_Sales, fill = Platform_Group) + 
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle=30)) + 
  labs(title = "Number of Global Video Game Sales by Genre and Platform Type",
       x = "Genre", y = "Number of Global Sales (millions)",
       fill = "Platform Type")
```

```{r}
# 
library(ggseas)

data %>% 
  group_by(Year) %>% 
  summarize(Total_Global = sum(Global_Sales, na.rm=TRUE)) %>% 
  ggplot() +
  aes(x = Year, y = Total_Global) + 
  geom_line(color = 'orchid') +
  stat_rollapplyr(width = 3, fun = mean, align = 'center', color = 'firebrick') +
  labs(title = "3 Year Moving Average of Global Sales",
       x = "Year", y = "Global Sales (millions)")
```

```{r}
# Dendrogram of platforms

platform_sales = data %>% 
  group_by(Platform) %>% 
  summarize(N.A = sum(NA_Sales, na.rm=TRUE),
            E.U = sum(EU_Sales, na.rm=TRUE),
            J.P = sum(JP_Sales, na.rm=TRUE),
            Other = sum(Other_Sales, na.rm=TRUE)) %>% 
  column_to_rownames("Platform")

scaled_platform = scale(platform_sales)
dist_platform = dist(scaled_platform)
hc_platform = hclust(dist_platform, method = "complete")
dend = as.dendrogram(hc_platform)

dominant_region = apply(platform_sales, 1, function(x) names(which.max(x)))

region_palette = c(
  "N.A"   = "steelblue",
  "E.U"    = "darkorange",
  "J.P"    = "firebrick",
  "Other" = "forestgreen"
)

dend_labs = labels(dend)
label_colors = region_palette[dominant_region[dend_labs]]
dend <- dend %>% 
  set("labels_colors", label_colors)

plot(dend, main = "Dendrogram of Platform (Colored by Dominant Region)")
legend("topright",
       legend = names(region_palette),
       fill = region_palette,
       border = NA,
       cex = 0.8,
       bty = "n")
```

```{r}
# Dendrogram of genre

genre_sales = data %>% 
  group_by(Genre) %>% 
  summarize(N.A = sum(NA_Sales, na.rm=TRUE),
            E.U = sum(EU_Sales, na.rm=TRUE),
            J.P = sum(JP_Sales, na.rm=TRUE),
            Other = sum(Other_Sales, na.rm=TRUE)) %>% 
  column_to_rownames("Genre")

scaled_genre = scale(genre_sales)
dist_genre = dist(scaled_genre)
hc_genre = hclust(dist_genre, method = "complete")
dend = as.dendrogram(hc_genre)

dominant_region = apply(genre_sales, 1, function(x) names(which.max(x)))

region_palette = c(
  "N.A"   = "steelblue",
  "E.U"    = "darkorange",
  "J.P"    = "firebrick",
  "Other" = "forestgreen"
)

dend_labs = labels(dend)
label_colors = region_palette[dominant_region[dend_labs]]
dend <- dend %>% 
  set("labels_colors", label_colors)

plot(dend, main = "Dendrogram of Genre (Colored by Dominant Region)")
legend("topright",
       legend = names(region_palette),
       fill = region_palette,
       border = NA,
       cex = 0.8,
       bty = "n")
```


```{r}
# # Animated Sales Over Time (Visualized on Map)
# world <- map_data("world")
# 
# region_year <- data %>%
#   group_by(Year) %>%
#   summarise(
#     N.A = sum(NA_Sales, na.rm = TRUE),
#     E.U = sum(EU_Sales, na.rm = TRUE),
#     J.P = sum(JP_Sales, na.rm = TRUE),
#     Other = sum(Other_Sales, na.rm = TRUE)
#   ) %>%
#   pivot_longer(cols = -Year, names_to = "region", values_to = "sales")
# 
# world_mapped <- world %>%
#   mutate(region = case_when(
#     region %in% c("USA", "Canada", "Mexico") ~ "N.A",
#     region %in% c("UK", "France", "Germany", "Italy", "Spain", "Portugal",
#                   "Netherlands", "Belgium", "Switzerland", "Austria",
#                   "Poland", "Sweden", "Norway", "Denmark", "Finland") ~ "E.U",
#     region == "Japan" ~ "J.P",
#     TRUE ~ "Other"
#   )) %>%
#   left_join(region_year, by = "region", relationship = "many-to-many")
# 
# p <- ggplot(world_mapped, aes(x = long, y = lat, group = group)) +
#   geom_polygon(aes(fill = sales), color = "white", size = 0.1) +
#   scale_fill_viridis_c(
#     option = "plasma", 
#     trans = "sqrt",
#     na.value = "grey90"
#   ) +
#   labs(
#     title = "Video Game Sales by Region: {round(frame_time)}",
#     subtitle = "Global market distribution over time",
#     fill = "Sales\n(millions)"
#   ) +
#   coord_fixed(1.3) +
#   transition_time(Year) +
#   ease_aes('linear')
# 
# anim <- animate(
#   p, 
#   width = 600,
#   height = 400,
#   fps = 5,
#   duration = 6,
#   nframes = 30,
#   renderer = gifski_renderer()
# )
# 
# anim
# 
# anim_save("animated_world_sales.gif", animation = anim)
```

```{r, echo=FALSE, fig.align='center', out.width='80%'}
knitr::include_graphics("animated_world_sales.gif")
```


```{r}
# # Bar plot animation
# p <- ggplot(region_year, aes(x = region, y = sales, fill = region)) +
#   geom_col() +
#   scale_fill_viridis_d() +
#   scale_y_continuous(limits = c(0, 500)) +
#   labs(title = "Video Game Sales by Region - Year: {as.integer(frame_time)}", 
#        y = "Sales (millions)", x = "Region") +
#   transition_time(Year)
# 
# anim <- animate(p, nframes = 30, fps = 10, width = 600, height = 400,
#                 renderer = gifski_renderer())
# anim
# anim_save("animated_sales_bar.gif", animation = anim)
```

```{r, echo=FALSE, fig.align='center', out.width='80%'}
knitr::include_graphics("animated_sales_bar.gif")
```




```{r}
library(tidyverse)

vgsales <- read_csv("vgsales.csv")

vgsales_clean <- vgsales %>%
  filter(!is.na(Year),
         !is.na(Global_Sales),
         !is.na(Genre),
         Year >= 1980) %>%
  mutate(Year = as.numeric(Year))

ggplot(vgsales_clean,
       aes(x = Year,
           y = Global_Sales,
           color = Genre,
           size = NA_Sales)) +
  
  geom_point(alpha = 0.6) +
  scale_size(range = c(1, 7)) +
  
  labs(
    title = "Global Video Game Sales Over Time by Genre",
    subtitle = "Point size represents North American Sales (millions)",
    x = "Release Year",
    y = "Global Sales (millions)",
    color = "Genre",
    size = "NA Sales"
  ) +
  
  coord_cartesian(ylim = c(0, 50)) +
  theme_classic() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    legend.key.height = unit(0.4, "cm"),
    legend.key.width  = unit(0.4, "cm"),
    legend.text = element_text(size = 9),
    legend.title = element_text(size = 10)
  ) +
  
  # Fix the legend overflow
  guides(color = guide_legend(ncol = 2))
```

```{r, fig.width = 10, fig.height = 8}
library(tidyverse)
library(tm)
library(wordcloud)

vgsales <- read_csv("vgsales.csv")

vgsales_clean <- vgsales %>%
  filter(!is.na(Name) & !is.na(Global_Sales))

top_games <- vgsales_clean %>%
  filter(Global_Sales >= quantile(Global_Sales, 0.75, na.rm = TRUE))

low_games <- vgsales_clean %>%
  filter(Global_Sales < quantile(Global_Sales, 0.75, na.rm = TRUE))

game_titles_top <- Corpus(VectorSource(top_games$Name))
game_titles_low <- Corpus(VectorSource(low_games$Name))

game_titles_top <- tm_map(game_titles_top, content_transformer(tolower))
game_titles_top <- tm_map(game_titles_top, removePunctuation)
game_titles_top <- tm_map(game_titles_top, stripWhitespace)

game_titles_low <- tm_map(game_titles_low, content_transformer(tolower))
game_titles_low <- tm_map(game_titles_low, removePunctuation)
game_titles_low <- tm_map(game_titles_low, stripWhitespace)

titleTopLow <- tm:::c.VCorpus(game_titles_top, game_titles_low)
titleTopLow <- tm_map(titleTopLow, PlainTextDocument)

titleTopLow <- tm_map(titleTopLow, removeWords, stopwords("english"))
titleTopLow <- tm_map(titleTopLow, stemDocument)

tdm_toplow <- TermDocumentMatrix(titleTopLow)

tdm_toplow <- as.matrix(tdm_toplow)

tdm_toplow_sum <- cbind(
  Top = rowSums(tdm_toplow[, 1:nrow(top_games)]),
  Lower = rowSums(tdm_toplow[, (nrow(top_games) + 1):ncol(tdm_toplow)])
)

comparison.cloud(tdm_toplow_sum,
                 max.words = 100,
                 random.order = FALSE,
                 colors = c("darkgreen", "purple"),
                 scale = c(3.5, 0.5),
                 title.size = 1.5,
                 rot.per = 0.3)
title(main = "Comparison Word Cloud: Top-Selling vs Lower-Selling Video Games",
      cex.main = 1.2)
```

```{r}
library(tidyverse)

vgsales <- read_csv("vgsales.csv")

summary(vgsales)

sales_by_region <- vgsales %>%
  filter(!is.na(Year) & Year != "N/A") %>%
  mutate(Year = as.numeric(Year)) %>%
  filter(Year <= 2016) %>%
  pivot_longer(cols = c(NA_Sales, EU_Sales, JP_Sales, Other_Sales),
               names_to = "Region",
               values_to = "Sales") %>%
  group_by(Year, Region) %>%
  summarize(Total_Sales = sum(Sales, na.rm = TRUE), .groups = "drop") %>%
  mutate(Region = case_when(
    Region == "NA_Sales" ~ "North America",
    Region == "EU_Sales" ~ "Europe",
    Region == "JP_Sales" ~ "Japan",
    Region == "Other_Sales" ~ "Other"
  ))

ggplot(sales_by_region, aes(x = Year, y = Total_Sales, fill = Region)) +
  geom_area(position = "fill") +
  scale_fill_discrete() +
  labs(title = "Proportion of Video Game Sales by Region Over Time",
       subtitle = "How the global video game market share has shifted (1980-2016)",
       x = "Year",
       y = "Proportion of Total Sales",
       fill = "Region") +
  theme(legend.position = "bottom")
```
